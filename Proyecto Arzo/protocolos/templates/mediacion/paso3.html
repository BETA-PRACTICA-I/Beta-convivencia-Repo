{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paso 3: Acta Final de Mediación</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <link rel="stylesheet" href="{% static 'css/Form1styles.css' %}">
</head>
<body>

<div class="container-fluid my-4">
    <div class="row justify-content-center">
        <div class="col-lg-10 col-xl-9">

            <div class="card shadow-sm mb-4">
                <div class="card-body p-4 p-md-5">

                    <h2 class="card-title h4 mb-1">Protocolo: {{ tipo_nombre }}</h2>
                    <p class="text-muted mb-4">Paso 3 de 3: Ficha N°3/4 - Acta Final</p>

                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}

                        <fieldset class="mb-4">
                            <legend class="h6 fw-bold border-bottom pb-2 mb-3">1. Datos Generales del Acta</legend>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    {{ form.fecha_acta.label_tag }}
                                    {{ form.fecha_acta }}
                                </div>
                            </div>
                            <div class="mb-3">
                                {{ form.partes_individualizadas.label_tag }}
                                {{ form.partes_individualizadas }}
                            </div>
                        </fieldset>

                        <fieldset class="mb-4">
                            <legend class="h6 fw-bold border-bottom pb-2 mb-3">2. Resultado del Proceso</legend>
                            <div class="mb-3">
                                <label class="form-label">{{ form.acuerdo_logrado.label }}</label>
                                <div>{{ form.acuerdo_logrado }}</div>
                            </div>
                        </fieldset>

                        <fieldset class="mb-4" id="seccion-acuerdo-logrado" style="display: none;">
                            <legend class="h6 fw-bold text-success border-bottom pb-2 mb-3">3. Acuerdos (Ficha N°3)</legend>
                            
                            <div class="p-3 border rounded mb-3">
                                <h6 class="fw-bold">Acuerdo N° 1</h6>
                                <div class="mb-3">{{ form.acuerdo_1_objetivo.label_tag }} {{ form.acuerdo_1_objetivo }}</div>
                                <div class="mb-3">{{ form.acuerdo_1_actividades.label_tag }} {{ form.acuerdo_1_actividades }}</div>
                                <div class="row">
                                    <div class="col-md-4 mb-3">{{ form.acuerdo_1_responsable.label_tag }} {{ form.acuerdo_1_responsable }}</div>
                                    <div class="col-md-4 mb-3">{{ form.acuerdo_1_verificacion.label_tag }} {{ form.acuerdo_1_verificacion }}</div>
                                    <div class="col-md-4 mb-3">{{ form.acuerdo_1_plazos.label_tag }} {{ form.acuerdo_1_plazos }}</div>
                                </div>
                            </div>
                            
                            <div class="p-3 border rounded mb-3">
                                <h6 class="fw-bold">Acuerdo N° 2 (Opcional)</h6>
                                <div class="mb-3">{{ form.acuerdo_2_objetivo.label_tag }} {{ form.acuerdo_2_objetivo }}</div>
                                <div class="mb-3">{{ form.acuerdo_2_actividades.label_tag }} {{ form.acuerdo_2_actividades }}</div>
                                <div class="row">
                                    <div class="col-md-4 mb-3">{{ form.acuerdo_2_responsable.label_tag }} {{ form.acuerdo_2_responsable }}</div>
                                    <div class="col-md-4 mb-3">{{ form.acuerdo_2_verificacion.label_tag }} {{ form.acuerdo_2_verificacion }}</div>
                                    <div class="col-md-4 mb-3">{{ form.acuerdo_2_plazos.label_tag }} {{ form.acuerdo_2_plazos }}</div>
                                </div>
                            </div>

                            <div class="p-3 border rounded mb-3">
                                <h6 class="fw-bold">Acuerdo N° 3 (Opcional)</h6>
                                <div class="mb-3">{{ form.acuerdo_3_objetivo.label_tag }} {{ form.acuerdo_3_objetivo }}</div>
                                <div class="mb-3">{{ form.acuerdo_3_actividades.label_tag }} {{ form.acuerdo_3_actividades }}</div>
                                <div class="row">
                                    <div class="col-md-4 mb-3">{{ form.acuerdo_3_responsable.label_tag }} {{ form.acuerdo_3_responsable }}</div>
                                    <div class="col-md-4 mb-3">{{ form.acuerdo_3_verificacion.label_tag }} {{ form.acuerdo_3_verificacion }}</div>
                                    <div class="col-md-4 mb-3">{{ form.acuerdo_3_plazos.label_tag }} {{ form.acuerdo_3_plazos }}</div>
                                </div>
                            </div>
                        </fieldset>
                        
                        <fieldset class="mb-4" id="seccion-acta-frustrada" style="display: none;">
                            <legend class="h6 fw-bold text-danger border-bottom pb-2 mb-3">3. Acta Frustrada (Ficha N°4)</legend>
                            <div class="mb-3">
                                {{ form.motivo_frustrado.label_tag }}
                                <p class="form-text">Indique el motivo por el cual no se alcanzaron acuerdos (Ej: una de las partes no asistió, no hubo voluntad de acuerdo, etc.)</p>
                                {{ form.motivo_frustrado }}
                            </div>
                        </fieldset>

                        <fieldset class="mb-4">
                            <legend class="h6 fw-bold border-bottom pb-2 mb-3">Firmas del Acta</legend>
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    {{ form.firma_conciliador.label_tag }}
                                    {{ form.firma_conciliador }}
                                </div>
                                <div class="col-md-4 mb-3">
                                    {{ form.firma_parte_1.label_tag }}
                                    {{ form.firma_parte_1 }}
                                </div>
                                <div class="col-md-4 mb-3">
                                    {{ form.firma_parte_2.label_tag }}
                                    {{ form.firma_parte_2 }}
                                </div>
                            </div>
                        </fieldset>


                        <hr class="my-4">
                        <div class="d-flex justify-content-between">
                            <a href="{% url 'protocolos:protocolo_step' protocolo.id 2 %}" class="btn btn-outline-secondary">
                                Atrás
                            </a>
                            <button type="submit" class="btn btn-primary btn-success">
                                Finalizar Protocolo
                            </button>
                        </div>
                    </form>

                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Referencias a los elementos
    const radiosResultado = document.querySelectorAll('input[name="acuerdo_logrado"]');
    const seccionAcuerdo = document.getElementById('seccion-acuerdo-logrado');
    const seccionFrustrado = document.getElementById('seccion-acta-frustrada');

    // Función para mostrar/ocultar secciones
    function toggleSections() {
        const valorSeleccionado = document.querySelector('input[name="acuerdo_logrado"]:checked');
        
        if (valorSeleccionado) {
            if (valorSeleccionado.value === 'True') {
                seccionAcuerdo.style.display = 'block';
                seccionFrustrado.style.display = 'none';
            } else if (valorSeleccionado.value === 'False') {
                seccionAcuerdo.style.display = 'none';
                seccionFrustrado.style.display = 'block';
            }
        } else {
            // Estado inicial si nada está seleccionado
            seccionAcuerdo.style.display = 'none';
            seccionFrustrado.style.display = 'none';
        }
    }

    // Añadir el evento 'change' a cada radio button
    radiosResultado.forEach(function(radio) {
        radio.addEventListener('change', toggleSections);
    });

    // Ejecutar la función al cargar la página (para el caso de editar)
    toggleSections();
});
</script>

</body>
</html>